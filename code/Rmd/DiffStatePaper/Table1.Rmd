```{r setup, include=FALSE}
library(synapseClient)
library(plyr)
library(dplyr)
library(data.table)
library(stringr)
library(tidyr)
library(reshape2)
library(ComplexHeatmap)
synapseLogin()

knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
```

```{r query}
# Which columns to consider
colsToUse <- c('id', 'dataType', 'fileType', 'fileSubType', 'UID', 'biologicalSampleName',
               'C4_Cell_Line_ID', 'Originating_Lab_ID', 'Originating_Lab', 'Cell_Line_Type',
               'Cell_Type_of_Origin', 'Tissue_of_Origin', 'Reprogramming_Vector_Type',
               'Reprogramming_Gene_Combination', 'pass_qc', 'exclude')

# query the table with specific columns
colsToUseStr <- paste(colsToUse, collapse=",")
queryTemplate <- "select %s from file where benefactorId=='syn1773109' and dataType=='%s'"

rnaData <- synQuery(sprintf(queryTemplate, colsToUseStr, 'mRNA'), 
                    blockSize=300)$collectAll()

mirnaData <- synQuery(sprintf(queryTemplate, colsToUseStr, 'miRNA'), 
                      blockSize=400)$collectAll()

methylationData <- synQuery(sprintf(queryTemplate, colsToUseStr, 'methylation'), 
                            blockSize=400)$collectAll()

# Combine the data together
allData <- rbind(rnaData, mirnaData, methylationData)
colnames(allData) <- gsub(".*\\.", "", colnames(allData))
allData <- allData[, colsToUse]
```

